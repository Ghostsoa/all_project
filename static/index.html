<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web SSH å®¢æˆ·ç«¯ç®¡ç†</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/xterm@5.3.0/css/xterm.min.css">
    <link rel="stylesheet" href="/static/style.css">
    <!-- Markdownä»£ç é«˜äº®æ ·å¼ -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/styles/github-dark.min.css">
</head>
<body>
    <div class="header">
        <h1>ğŸ–¥ï¸ Web SSH å®¢æˆ·ç«¯ç®¡ç†</h1>
        <div class="header-actions">
            <button class="btn btn-secondary" onclick="logout()">ğŸšª é€€å‡ºç™»å½•</button>
        </div>
    </div>

    <div class="main-container">
        <!-- å·¦ä¾§æœåŠ¡å™¨åˆ—è¡¨ -->
        <div class="sidebar">
            <div class="sidebar-header">
                <button class="btn-add-server" onclick="showAddServerModal()">
                    â• æ·»åŠ æœåŠ¡å™¨
                </button>
            </div>
            <div class="local-terminal-btn">
                <button class="btn-local-terminal" onclick="openLocalTerminal()">
                    ğŸ’» æœ¬åœ°ç»ˆç«¯
                </button>
            </div>
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="ğŸ” æœç´¢æœåŠ¡å™¨..." onkeyup="searchServers()">
            </div>
            <div class="server-list" id="serverList">
                <div class="loading">åŠ è½½ä¸­...</div>
            </div>
        </div>

        <!-- ä¸­é—´ç»ˆç«¯åŒºåŸŸ -->
        <div class="terminal-area">
            <!-- ç©ºçŠ¶æ€æç¤º -->
            <div class="no-selection" id="noSelection">
                <div class="no-selection-content">
                    <h2>ğŸ‘ˆ è¯·ä»å·¦ä¾§é€‰æ‹©æœåŠ¡å™¨è¿æ¥</h2>
                    <p>æ”¯æŒå¤šçª—å£ç»ˆç«¯ï¼Œå¯åŒæ—¶è¿æ¥å¤šå°æœåŠ¡å™¨</p>
                </div>
            </div>

            <!-- ç»ˆç«¯çª—å£åŒºåŸŸ -->
            <div class="terminal-wrapper" id="terminalWrapper" style="display: none;">
                <!-- å¤šçª—å£æ ‡ç­¾æ  -->
                <div class="tabs-bar">
                    <div class="tabs-list" id="tabsList">
                        <div class="tab-item active" data-type="terminal" onclick="window.switchToTerminalTab()">
                            ğŸ’» ç»ˆç«¯
                        </div>
                    </div>
                </div>

                <!-- å†…å®¹åŒºåŸŸï¼ˆæ–‡ä»¶æ ‘ + ç»ˆç«¯/ç¼–è¾‘å™¨ï¼‰ -->
                <div class="content-with-sidebar">
                    <!-- å·¦ä¾§æ–‡ä»¶æ ‘ä¾§è¾¹æ  -->
                    <div class="file-sidebar" id="fileSidebar">
                        <div class="file-sidebar-header">
                            <span>æ–‡ä»¶æµè§ˆ</span>
                            <div class="file-header-actions">
                                <label class="show-hidden-checkbox" title="æ˜¾ç¤ºéšè—æ–‡ä»¶">
                                    <input type="checkbox" id="showHiddenFiles">
                                    <span>.éšè—</span>
                                </label>
                                <button class="refresh-btn" id="refreshBtn" title="åˆ·æ–° (F5)">ğŸ”„</button>
                            </div>
                        </div>
                        <div class="file-tree" id="fileTree">
                            <div class="file-tree-empty">è¿æ¥æœåŠ¡å™¨åæ˜¾ç¤ºæ–‡ä»¶</div>
                        </div>
                    </div>

                    <!-- ä¸»å†…å®¹åŒº -->
                    <div class="main-content">
                        <!-- ç»Ÿä¸€å†…å®¹æ ‡ç­¾æ ï¼šç»ˆç«¯ + æ–‡ä»¶ -->
                        <div class="content-tabs-bar" id="contentTabsBar">
                            <div class="content-tabs-list" id="contentTabsList">
                                <!-- é»˜è®¤ç»ˆç«¯æ ‡ç­¾åœ¨ terminal.js ä¸­åˆ›å»º -->
                            </div>
                        </div>
                        
                        <!-- å†…å®¹å®¹å™¨ï¼šç»ˆç«¯å’Œç¼–è¾‘å™¨ -->
                        <div class="content-container" id="contentContainer"></div>
                    </div>
                </div>

                <!-- çŠ¶æ€ç¯å¸¦ - çº¯ç¯å¸¦æ— æ–‡æœ¬ -->
                <div class="status-light-bar">
                    <div class="status-light" id="statusLight"></div>
                </div>
            </div>
        </div>

        <!-- å³ä¾§é¢æ¿ -->
        <div class="right-panel">
            <!-- æ ‡ç­¾åˆ‡æ¢æ  -->
            <div class="right-panel-tabs">
                <div class="right-tab" data-tab="ai" onclick="switchRightTab('ai')">
                    ğŸ¤– AI åŠ©æ‰‹
                </div>
                <div class="right-tab active" data-tab="commands" onclick="switchRightTab('commands')">
                    ğŸ“œ å‘½ä»¤è®°å½•
                </div>
            </div>

            <!-- AI åŠ©æ‰‹é¢æ¿ -->
            <div class="right-panel-content" id="aiPanel" style="display: none;">
                <div class="right-panel-placeholder">
                    <div class="placeholder-content">
                        <h3>ğŸ¤– AI åŠ©æ‰‹</h3>
                        <p>æ•¬è¯·æœŸå¾…...</p>
                    </div>
                </div>
            </div>

            <!-- å‘½ä»¤è®°å½•é¢æ¿ -->
            <div class="right-panel-content active" id="commandsPanel">
                <div class="commands-header">
                    <div class="commands-title">
                        <span id="commandsServerName">é€‰æ‹©æœåŠ¡å™¨æŸ¥çœ‹å‘½ä»¤</span>
                    </div>
                    <button class="btn-clear-commands" onclick="clearCurrentCommands()" title="åˆ é™¤å‘½ä»¤">åˆ é™¤</button>
                </div>
                <div class="commands-list" id="commandsList">
                    <div class="commands-empty">
                        <p>æš‚æ— å‘½ä»¤è®°å½•</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- æ·»åŠ /ç¼–è¾‘æœåŠ¡å™¨æ¨¡æ€æ¡† -->
    <div class="modal" id="serverModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">æ·»åŠ æœåŠ¡å™¨</h2>
                <button class="btn-close" onclick="closeModal()">âœ•</button>
            </div>
            <div class="modal-body">
                <form id="serverForm">
                    <input type="hidden" id="serverId">
                    <div class="form-group">
                        <label>æœåŠ¡å™¨åç§° *</label>
                        <input type="text" id="serverName" placeholder="ä¾‹å¦‚ï¼šç”Ÿäº§æœåŠ¡å™¨" required>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>ä¸»æœºåœ°å€ *</label>
                            <input type="text" id="serverHost" placeholder="192.168.1.1" required>
                        </div>
                        <div class="form-group">
                            <label>ç«¯å£</label>
                            <input type="number" id="serverPort" value="22" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>ç”¨æˆ·å *</label>
                        <input type="text" id="serverUsername" placeholder="root" required>
                    </div>
                    <div class="form-group">
                        <label>å¯†ç  *</label>
                        <input type="password" id="serverPassword" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢" required>
                    </div>
                    <div class="form-group">
                        <label>æè¿°</label>
                        <textarea id="serverDescription" rows="3" placeholder="æœåŠ¡å™¨ç”¨é€”è¯´æ˜..."></textarea>
                    </div>
                    <div class="form-group">
                        <label>æ ‡ç­¾</label>
                        <div class="tags-input-wrapper">
                            <div class="tags-display" id="tagsDisplay"></div>
                            <input type="text" id="serverTagsInput" placeholder="è¾“å…¥æ ‡ç­¾åæŒ‰å›è½¦..." class="tag-input">
                        </div>
                        <small class="form-hint">æŒ‰å›è½¦æ·»åŠ æ ‡ç­¾ï¼Œç‚¹å‡»æ ‡ç­¾å¯åˆ é™¤</small>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal()">å–æ¶ˆ</button>
                <button class="btn btn-primary" onclick="saveServer()">ä¿å­˜</button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/xterm@5.3.0/lib/xterm.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xterm-addon-fit@0.8.0/lib/xterm-addon-fit.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/monaco-editor@0.45.0/min/vs/loader.js"></script>
    <!-- Markdownæ¸²æŸ“åº“ -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/highlight.min.js"></script>
    <script>
        // éªŒè¯markedå’Œhljsæ˜¯å¦åŠ è½½
        console.log('markedç±»å‹:', typeof marked, 'marked.parse:', typeof marked?.parse);
        console.log('hljsç±»å‹:', typeof hljs);
        
        // ç¡®ä¿æš´éœ²åˆ°window
        if (typeof marked !== 'undefined') {
            window.marked = marked;
            console.log('âœ… markedå·²æš´éœ²åˆ°window.marked');
        }
        if (typeof hljs !== 'undefined') {
            window.hljs = hljs;
            console.log('âœ… hljså·²æš´éœ²åˆ°window.hljs');
        }
    </script>
    <script type="module" src="/static/js/main.js"></script>
</body>
</html>
