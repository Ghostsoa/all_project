<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web SSH ÂÆ¢Êà∑Á´ØÁÆ°ÁêÜ</title>
    <link rel="stylesheet" href="/static/vendor/xterm/css/xterm.min.css">
    <!-- Ê®°ÂùóÂåñCSS -->
    <link rel="stylesheet" href="/static/css/base.css">
    <link rel="stylesheet" href="/static/css/layout.css">
    <link rel="stylesheet" href="/static/css/sidebar.css">
    <link rel="stylesheet" href="/static/css/terminal.css">
    <link rel="stylesheet" href="/static/css/filetree.css">
    <link rel="stylesheet" href="/static/css/editor.css">
    <link rel="stylesheet" href="/static/css/media.css">
    <link rel="stylesheet" href="/static/css/commands.css">
    <link rel="stylesheet" href="/static/css/modal.css">
    <link rel="stylesheet" href="/static/css/components.css">
    <link rel="stylesheet" href="/static/css/upload-progress.css">
    <link rel="stylesheet" href="/static/css/ai-assistant.css">
    <link rel="stylesheet" href="/static/css/ai-settings.css">
    <!-- DeviconÂõæÊ†áÂ∫ì - ‰∏ì‰∏öÂºÄÂèëËÄÖÂõæÊ†á -->
    <link rel="stylesheet" href="/static/vendor/devicon/devicon.min.css">
    <!-- Font AwesomeÂõæÊ†áÂ∫ì - ÈÄöÁî®Êñá‰ª∂ÂõæÊ†á -->
    <link rel="stylesheet" href="/static/vendor/fontawesome/css/all.min.css">
    <!-- Markdown‰ª£Á†ÅÈ´ò‰∫ÆÊ†∑Âºè -->
    <link rel="stylesheet" href="/static/vendor/highlight.js/styles/github-dark.min.css">
</head>
<body>
    <div class="header">
        <h1>üñ•Ô∏è Web SSH ÂÆ¢Êà∑Á´ØÁÆ°ÁêÜ</h1>
        <div class="header-actions">
            <button class="btn btn-secondary" onclick="logout()">üö™ ÈÄÄÂá∫ÁôªÂΩï</button>
        </div>
    </div>

    <!-- ÂÖ®Â±ÄÁä∂ÊÄÅÁÅØÂ∏¶ -->
    <div class="global-status-light-bar">
        <div class="global-status-light" id="globalStatusLight"></div>
    </div>

    <div class="main-container">
        <!-- Â∑¶‰æßÊúçÂä°Âô®ÂàóË°® -->
        <div class="sidebar">
            <div class="sidebar-header">
                <button class="btn-add-server" onclick="showAddServerModal()">
                    <span>‚ûï</span>
                    <span class="btn-add-server-text"> Ê∑ªÂä†ÊúçÂä°Âô®</span>
                </button>
            </div>
            <div class="local-terminal-btn">
                <button class="btn-local-terminal" onclick="openLocalTerminal()">
                    <span>üíª</span>
                    <span class="btn-local-terminal-text"> Êú¨Âú∞ÁªàÁ´Ø</span>
                </button>
            </div>
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="üîç ÊêúÁ¥¢ÊúçÂä°Âô®..." onkeyup="searchServers()">
            </div>
            <div class="server-list" id="serverList">
                <div class="loading">Âä†ËΩΩ‰∏≠...</div>
            </div>
            
            <!-- ÊäòÂè†ÂàáÊç¢ÊåâÈíÆ - Â∫ïÈÉ® -->
            <div class="sidebar-footer">
                <button class="sidebar-toggle" onclick="toggleSidebar()" title="ÊäòÂè†/Â±ïÂºÄ">
                    <span class="toggle-icon">
                        <span></span>
                        <span></span>
                        <span></span>
                    </span>
                    <span class="toggle-text">ÊäòÂè†</span>
                </button>
            </div>
        </div>

        <!-- ‰∏≠Èó¥ÁªàÁ´ØÂå∫Âüü -->
        <div class="terminal-area">
            <!-- AIËÆæÁΩÆÈù¢Êùø - Ë¶ÜÁõñ‰∏≠Èó¥Âå∫Âüü -->
            <div class="ai-settings-panel" id="aiSettingsPanel" style="display: none;">
                <div class="settings-panel-header">
                    <h2>AI ËÆæÁΩÆ</h2>
                    <button class="close-btn" onclick="closeAISettings()">
                        <i class="fa-solid fa-times"></i>
                    </button>
                </div>

                <div class="settings-panel-tabs">
                    <button class="settings-tab active" onclick="switchSettingsTab('providers')">
                        <i class="fa-solid fa-server"></i> ‰æõÂ∫îÂïÜÁÆ°ÁêÜ
                    </button>
                    <button class="settings-tab" onclick="switchSettingsTab('config')">
                        <i class="fa-solid fa-sliders"></i> ÂÖ®Â±ÄÈÖçÁΩÆ
                    </button>
                </div>

                <div class="settings-panel-content">
                    <!-- ‰æõÂ∫îÂïÜÁÆ°ÁêÜ -->
                    <div id="providersTab" class="settings-tab-content">
                        <div class="providers-header">
                            <button class="btn-primary" onclick="openProviderForm()">
                                <i class="fa-solid fa-plus"></i> Ê∑ªÂä†‰æõÂ∫îÂïÜ
                            </button>
                        </div>
                        <div id="providersList" class="providers-list">
                            <div class="loading">Âä†ËΩΩ‰∏≠...</div>
                        </div>
                    </div>

                    <!-- ÂÖ®Â±ÄÈÖçÁΩÆ -->
                    <div id="configTab" class="settings-tab-content" style="display: none;">
                        <form id="globalConfigForm" class="config-form" onsubmit="saveGlobalConfig(event); return false;">
                            <div class="form-group">
                                <label>Á≥ªÁªüÊèêÁ§∫ËØç</label>
                                <textarea id="systemPrompt" rows="4" placeholder="‰Ω†ÊòØ‰∏Ä‰∏™‰∏ì‰∏öÁöÑAIÂä©Êâã..."></textarea>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label>Temperature <span id="tempValue">0.7</span></label>
                                    <input type="range" id="temperature" min="0" max="2" step="0.1" value="0.7" oninput="updateRangeDisplay()">
                                </div>
                                <div class="form-group">
                                    <label>Max Tokens</label>
                                    <input type="number" id="maxTokens" value="4096">
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label>Top P <span id="topPValue">1.0</span></label>
                                    <input type="range" id="topP" min="0" max="1" step="0.05" value="1.0" oninput="updateRangeDisplay()">
                                </div>
                                <div class="form-group">
                                    <label>Frequency Penalty <span id="freqValue">0</span></label>
                                    <input type="range" id="frequencyPenalty" min="-2" max="2" step="0.1" value="0" oninput="updateRangeDisplay()">
                                </div>
                            </div>

                            <div class="form-group">
                                <label>Presence Penalty <span id="presValue">0</span></label>
                                <input type="range" id="presencePenalty" min="-2" max="2" step="0.1" value="0" oninput="updateRangeDisplay()">
                            </div>

                            <div class="form-actions">
                                <button type="submit" class="btn-primary">
                                    <i class="fa-solid fa-save"></i> ‰øùÂ≠ò
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <div class="settings-panel-footer">
                    <button class="btn-secondary" onclick="closeAISettings()">
                        <i class="fa-solid fa-times"></i> ÂèñÊ∂à
                    </button>
                </div>
            </div>

            <!-- ‰æõÂ∫îÂïÜË°®ÂçïÂºπÁ™ó -->
            <div id="providerFormModal" class="modal-overlay" style="display: none;">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3 id="providerFormTitle">Ê∑ªÂä†‰æõÂ∫îÂïÜ</h3>
                        <button class="modal-close" onclick="closeProviderForm()">
                            <i class="fa-solid fa-times"></i>
                        </button>
                    </div>
                    <form id="providerForm" onsubmit="saveProvider(event); return false;">
                        <div class="form-group">
                            <label>‰æõÂ∫îÂïÜID *</label>
                            <input type="text" id="providerId" required placeholder="Â¶Ç: openai">
                        </div>
                        <div class="form-group">
                            <label>ÊòæÁ§∫ÂêçÁß∞ *</label>
                            <input type="text" id="providerName" required placeholder="Â¶Ç: OpenAI">
                        </div>
                        <div class="form-group">
                            <label>Base URL *</label>
                            <input type="url" id="providerBaseUrl" required placeholder="https://api.openai.com/v1">
                        </div>
                        <div class="form-group">
                            <label>API Key *</label>
                            <input type="password" id="providerApiKey" required>
                        </div>
                        <div class="form-group">
                            <label>Ê®°ÂûãÂàóË°® *</label>
                            <div id="providerModels"></div>
                            <button type="button" class="btn-secondary" onclick="addModelRow()">
                                <i class="fa-solid fa-plus"></i> Ê∑ªÂä†Ê®°Âûã
                            </button>
                        </div>
                        <div class="form-actions">
                            <button type="button" class="btn-secondary" onclick="closeProviderForm()">ÂèñÊ∂à</button>
                            <button type="submit" class="btn-primary">‰øùÂ≠ò</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Á©∫Áä∂ÊÄÅÊèêÁ§∫ -->
            <div class="no-selection" id="noSelection">
                <div class="no-selection-content">
                    <h2>üëà ËØ∑‰ªéÂ∑¶‰æßÈÄâÊã©ÊúçÂä°Âô®ËøûÊé•</h2>
                    <p>ÊîØÊåÅÂ§öÁ™óÂè£ÁªàÁ´ØÔºåÂèØÂêåÊó∂ËøûÊé•Â§öÂè∞ÊúçÂä°Âô®</p>
                </div>
            </div>

            <!-- ÁªàÁ´ØÁ™óÂè£Âå∫Âüü -->
            <div class="terminal-wrapper" id="terminalWrapper" style="display: none;">
                <!-- Â§öÁ™óÂè£Ê†áÁ≠æÊ†è -->
                <div class="tabs-bar">
                    <div class="tabs-list" id="tabsList">
                        <div class="tab-item active" data-type="terminal" onclick="window.switchToTerminalTab()">
                            üíª ÁªàÁ´Ø
                        </div>
                    </div>
                </div>

                <!-- ÂÜÖÂÆπÂå∫ÂüüÔºàÊñá‰ª∂Ê†ë + ÁªàÁ´Ø/ÁºñËæëÂô®Ôºâ -->
                <div class="content-with-sidebar">
                    <!-- Â∑¶‰æßÊñá‰ª∂Ê†ë‰æßËæπÊ†è -->
                    <div class="file-sidebar" id="fileSidebar">
                        <div class="file-sidebar-header">
                            <span>Êñá‰ª∂ÊµèËßà</span>
                            <div class="file-header-actions">
                                <label class="show-hidden-checkbox" title="ÊòæÁ§∫ÈöêËóèÊñá‰ª∂">
                                    <input type="checkbox" id="showHiddenFiles">
                                    <span>.ÈöêËóè</span>
                                </label>
                                <button class="refresh-btn" id="refreshBtn" title="Âà∑Êñ∞ (F5)">üîÑ</button>
                            </div>
                        </div>
                        <div class="file-tree" id="fileTree">
                            <div class="file-tree-empty">ËøûÊé•ÊúçÂä°Âô®ÂêéÊòæÁ§∫Êñá‰ª∂</div>
                        </div>
                    </div>

                    <!-- ‰∏ªÂÜÖÂÆπÂå∫ -->
                    <div class="main-content">
                        <!-- Áªü‰∏ÄÂÜÖÂÆπÊ†áÁ≠æÊ†èÔºöÁªàÁ´Ø + Êñá‰ª∂ -->
                        <div class="content-tabs-bar" id="contentTabsBar">
                            <div class="content-tabs-list" id="contentTabsList">
                                <!-- ÈªòËÆ§ÁªàÁ´ØÊ†áÁ≠æÂú® terminal.js ‰∏≠ÂàõÂª∫ -->
                            </div>
                        </div>
                        
                        <!-- ÂÜÖÂÆπÂÆπÂô®ÔºöÁªàÁ´ØÂíåÁºñËæëÂô® -->
                        <div class="content-container" id="contentContainer"></div>
                    </div>
                </div>

                <!-- Áä∂ÊÄÅÁÅØÂ∏¶ - Á∫ØÁÅØÂ∏¶Êó†ÊñáÊú¨ -->
                <div class="status-light-bar">
                    <div class="status-light" id="statusLight"></div>
                </div>
            </div>
        </div>

        <!-- Âè≥‰æßÈù¢Êùø -->
        <div class="right-panel">
            <!-- Ê†áÁ≠æÂàáÊç¢Ê†è -->
            <div class="right-panel-tabs">
                <div class="right-tab active" data-tab="ai" onclick="switchRightTab('ai')">
                    ü§ñ AI Âä©Êâã
                </div>
                <div class="right-tab" data-tab="commands" onclick="switchRightTab('commands')">
                    üìú ÂëΩ‰ª§ËÆ∞ÂΩï
                </div>
            </div>

            <!-- AI Âä©ÊâãÈù¢Êùø -->
            <div class="right-panel-content active" id="aiPanel">
                <!-- Âä†ËΩΩÈÅÆÁΩ© -->
                <div class="ai-loading-overlay" id="aiLoadingOverlay" style="display: none;">
                    <div class="ai-loading-spinner">
                        <p id="aiLoadingText" class="loading-shimmer-text">Ê≠£Âú®Âä†ËΩΩ‰∏≠</p>
                    </div>
                </div>
                
                <!-- È°∂ÈÉ®Â∑•ÂÖ∑Ê†è -->
                <div class="ai-toolbar">
                    <!-- Â∑¶‰æßÔºöÂØπËØùÂéÜÂè≤ -->
                    <div class="ai-history-selector">
                        <div class="history-trigger">
                            <span class="current-conversation" id="currentConversationTitle">ÂØπËØùÂéÜÂè≤</span>
                            <span class="history-arrow">‚ñº</span>
                        </div>
                        <!-- ÂéÜÂè≤ÂàóË°®‰∏ãÊãâ -->
                        <div class="history-dropdown-menu" id="historyDropdownMenu" style="display: none;">
                            <div id="aiConversationHistory">
                                <div class="loading">Âä†ËΩΩ‰∏≠...</div>
                            </div>
                        </div>
                    </div>

                    <!-- Âè≥‰æßÔºöËÆæÁΩÆ -->
                    <div class="ai-controls">
                        <!-- ËÆæÁΩÆÊåâÈíÆ -->
                        <button class="tool-btn" onclick="openAISettings()" title="ËÆæÁΩÆ">
                            <i class="fa-solid fa-gear"></i>
                        </button>
                    </div>
                </div>

                <!-- ÂØπËØùÂå∫Âüü -->
                <div class="ai-messages" id="aiMessages">
                    <div class="ai-welcome">
                        <div class="welcome-icon">ü§ñ</div>
                        <h3>AI Âä©Êâã</h3>
                        <p>ÂºÄÂßãÂØπËØùÔºåËé∑ÂèñÊô∫ËÉΩÂ∏ÆÂä©</p>
                    </div>
                </div>

                <!-- ËæìÂÖ•Âå∫Âüü -->
                <div class="ai-input-container">
                    <div class="input-box">
                        <textarea 
                            id="aiInput" 
                            placeholder="ËæìÂÖ•Ê∂àÊÅØ..."
                            rows="2"
                        ></textarea>
                        <div class="input-actions">
                            <!-- Ê®°ÂûãÈÄâÊã©ÔºàËæìÂÖ•Ê°ÜÂÜÖÔºâ -->
                            <div class="inline-model-selector">
                                <div class="model-trigger" onclick="toggleModelSelector()">
                                    <span id="selectedModel">GPT-4</span>
                                    <i class="fa-solid fa-chevron-up"></i>
                                </div>
                                <!-- Âêë‰∏äÂºπÂá∫ÁöÑÊ®°ÂûãÈÄâÊã©Âô® -->
                                <div class="model-popup" id="modelPopup" style="display: none;">
                                    <div class="model-list" id="modelList">
                                        <div class="loading-small">Âä†ËΩΩ‰∏≠...</div>
                                    </div>
                                </div>
                            </div>
                            <div class="input-buttons">
                                <!-- Ê∏ÖÁ©∫ÂØπËØùÊåâÈíÆ -->
                                <button class="clear-chat-btn" onclick="clearCurrentAIChat()" title="Ê∏ÖÁ©∫ÂΩìÂâçÂØπËØù">üóëÔ∏è</button>
                                <!-- ÂÅúÊ≠¢ÁîüÊàêÊåâÈíÆ -->
                                <button class="stop-generate-btn" id="stopGenerateBtn" onclick="stopAIGeneration()" title="ÂÅúÊ≠¢ÁîüÊàê" style="display: none;">
                                    <i class="fa-solid fa-stop"></i>
                                </button>
                                <!-- ÂèëÈÄÅÊåâÈíÆÔºàÂõæÊ†áÔºâ -->
                                <button class="send-icon-btn" id="sendAIBtn" onclick="sendAIMessage()" title="ÂèëÈÄÅ (Ctrl+Enter)">
                                    <i class="fa-solid fa-paper-plane"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ÂëΩ‰ª§ËÆ∞ÂΩïÈù¢Êùø -->
            <div class="right-panel-content" id="commandsPanel" style="display: none;">
                <div class="commands-header">
                    <div class="commands-title">
                        <span id="commandsServerName">ÈÄâÊã©ÊúçÂä°Âô®Êü•ÁúãÂëΩ‰ª§</span>
                    </div>
                    <button class="btn-clear-commands" onclick="clearCurrentCommands()" title="Âà†Èô§ÂëΩ‰ª§">Âà†Èô§</button>
                </div>
                <div class="commands-list" id="commandsList">
                    <div class="commands-empty">
                        <p>ÊöÇÊó†ÂëΩ‰ª§ËÆ∞ÂΩï</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Ê∑ªÂä†/ÁºñËæëÊúçÂä°Âô®Ê®°ÊÄÅÊ°Ü -->
    <div class="modal" id="serverModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Ê∑ªÂä†ÊúçÂä°Âô®</h2>
                <button class="btn-close" onclick="closeModal()">‚úï</button>
            </div>
            <div class="modal-body">
                <form id="serverForm">
                    <input type="hidden" id="serverId">
                    <div class="form-group">
                        <label>ÊúçÂä°Âô®ÂêçÁß∞ *</label>
                        <input type="text" id="serverName" placeholder="‰æãÂ¶ÇÔºöÁîü‰∫ßÊúçÂä°Âô®" required>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>‰∏ªÊú∫Âú∞ÂùÄ *</label>
                            <input type="text" id="serverHost" placeholder="192.168.1.1" required>
                        </div>
                        <div class="form-group">
                            <label>Á´ØÂè£</label>
                            <input type="number" id="serverPort" value="22" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Áî®Êà∑Âêç *</label>
                        <input type="text" id="serverUsername" placeholder="root" required>
                    </div>
                    <div class="form-group">
                        <label>ÂØÜÁ†Å *</label>
                        <input type="password" id="serverPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                    </div>
                    <div class="form-group">
                        <label>ÊèèËø∞</label>
                        <textarea id="serverDescription" rows="3" placeholder="ÊúçÂä°Âô®Áî®ÈÄîËØ¥Êòé..."></textarea>
                    </div>
                    <div class="form-group">
                        <label>Ê†áÁ≠æ</label>
                        <div class="tags-input-wrapper">
                            <div class="tags-display" id="tagsDisplay"></div>
                            <input type="text" id="serverTagsInput" placeholder="ËæìÂÖ•Ê†áÁ≠æÂêéÊåâÂõûËΩ¶..." class="tag-input">
                        </div>
                        <small class="form-hint">ÊåâÂõûËΩ¶Ê∑ªÂä†Ê†áÁ≠æÔºåÁÇπÂáªÊ†áÁ≠æÂèØÂà†Èô§</small>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal()">ÂèñÊ∂à</button>
                <button class="btn btn-primary" onclick="saveServer()">‰øùÂ≠ò</button>
            </div>
        </div>
    </div>

    <!-- ‰∏ä‰º†ËøõÂ∫¶ÂÆπÂô® -->
    <div id="uploadProgressContainer" class="upload-progress-container"></div>

    <script src="/static/vendor/xterm/lib/xterm.min.js"></script>
    <script src="/static/vendor/xterm-addon-fit/lib/xterm-addon-fit.min.js"></script>
    <script src="/static/vendor/xterm-addon-webgl/lib/xterm-addon-webgl.min.js"></script>
    <script src="/static/vendor/monaco-editor/min/vs/loader.js"></script>
    <!-- ‰ª£Á†ÅÈ´ò‰∫ÆÂ∫ì -->
    <script src="/static/vendor/highlight.js/lib/highlight.min.js"></script>
    <!-- MarkdownËß£ÊûêÂ∫ì -->
    <script src="/static/vendor/marked/marked.min.js"></script>
    <script>
        // Êö¥Èú≤hljsÂà∞window‰æõMarkdown‰ΩøÁî®
        if (typeof hljs !== 'undefined') {
            window.hljs = hljs;
            console.log('‚úÖ hljsÂ∑≤Âä†ËΩΩ');
        }
        // Êö¥Èú≤markedÂà∞window‰æõMarkdownÁºñËæëÂô®‰ΩøÁî®
        if (typeof marked !== 'undefined') {
            window.marked = marked;
            console.log('‚úÖ markedÂ∑≤Âä†ËΩΩ');
        }
    </script>
    <script type="module" src="/static/js/main.js"></script>
</body>
</html>
